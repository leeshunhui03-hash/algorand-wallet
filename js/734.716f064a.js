"use strict";(self["webpackChunkwallet"]=self["webpackChunkwallet"]||[]).push([[734],{14734:function(e,a,t){t.r(a),t.d(a,{default:function(){return Ae}});t(83248);var s=t(66760),l=t(98752),d=t(18568),o=t(70976),n=t(48936),i=t(75112),c=t(35920),r=t(53764),m=t(58284),p=t(14128),u=t(65216),f=t(54928),A=t(19728),h=t(6272),g=t.n(h),w=t(29672),D=t(22216),y=t(52774);const b={class:"field grid"},_={class:"col-12 mb-2 md:col-2 md:mb-0"},Q={class:"col-12 md:col-10"},v={class:"field grid"},I={class:"col-12 mb-2 md:col-2 md:mb-0"},W={class:"col-12 md:col-10"},K={class:"field grid"},$={class:"col-12 mb-2 md:col-2 md:mb-0"},x={class:"col-12 md:col-10"},T={class:"field grid"},k={class:"col-12 mb-2 md:col-2 md:mb-0"},V={class:"col-12 md:col-10"},S={class:"field grid"},C={class:"col-12 mb-2 md:col-2 md:mb-0"},P={class:"col-12 md:col-10"},N={class:"field grid"},B={class:"col-12 mb-2 md:col-2 md:mb-0"},Y={class:"col-12 md:col-10"},F={class:"field grid"},U={for:"amountToDeposit",class:"col-12 mb-2 md:col-2 md:mb-0"},E={class:"col-12 md:col-10"},z={class:"field grid"},O={for:"amountToDeposit",class:"col-12 mb-2 md:col-2 md:mb-0"},R={class:"col-12 md:col-10"},G={class:"field grid"},M=(0,s.QD)("label",{class:"col-12 mb-2 md:col-2 md:mb-0"},null,-1),j={class:"col-12 md:col-10"},J={key:0,class:"grid"},L={class:"col"},X={class:"p-input-icon-left"},Z=(0,s.QD)("i",{class:"pi pi-search"},null,-1),q={key:0},H={class:"field grid"},ee={for:"optin",class:"col-12 mb-2 md:col-2 md:mb-0"},ae={class:"col-12 md:col-10"},te={class:"field grid"},se={for:"withdrawAsset",class:"col-12 mb-2 md:col-2 md:mb-0"},le={class:"col-12 md:col-10"},de={class:"field grid"},oe={for:"withdrawAmount",class:"col-12 mb-2 md:col-2 md:mb-0"},ne={class:"col-12 md:col-10"},ie={class:"field grid"},ce=(0,s.QD)("label",{class:"col-12 mb-2 md:col-2 md:mb-0"},null,-1),re={class:"col-12 md:col-10"},me={class:"field grid"},pe={key:0,class:"field grid"};var ue=(0,s._M)({__name:"ScheduledPaymentDetail",setup(e){const a=(0,u.MJ)(),t=(0,n.o3)(),h=(0,u.KX)(),ue=(0,d.cB)({selection:"",payTo:"",assetData:new m.c,account:a.params.account,withdrawAmount:0,maxAmount:0,stepAmount:1,appInfo:{appId:0,appAddress:"",start:0,period:0,balanceFee:0,fee:0},assets:[],filters:{global:{value:null,matchMode:i.yI.CONTAINS}},period:"86400",optionsSchedule:[{value:"60",name:"Run each minute"},{value:"3600",name:"Run each hour"},{value:"86400",name:"Run each day"}],start:Math.round((new Date).getTime()/1e3),txID:"",action:"",hash:"",client:"",appId:"",fee:1e3,feeAssetId:0,feeAssetData:new m.c,optin:0,withdrawAsset:"",amountToDeposit:0,script:""}),fe=()=>{const e=t.state.wallet.privateAccounts.find((e=>e.addr==ue.account));return!!e&&(!!e.data&&e.data[t.state.config.env])},Ae=()=>{const e=fe();if(!ue.assetData)return 0;if("ARC200"==ue.assetData.type)return ue.assetData?ue.assetData.amount/10**ue.assetData.decimals:0;if("ASA"==ue.assetData.type)return ue.assetData?ue.assetData.amount/10**ue.assetData.decimals:0;{let a=e.amount/1e6-.1;return e["assets"]&&e["assets"].length>0&&(a-=.1*e["assets"].length),a}},he=()=>{if(!ue.assetData.decimals)return 1;const e=Math.pow(10,-1*ue.assetData.decimals);return e};(0,s.Kg)((()=>ue.assetData),(async()=>{ue.maxAmount=Ae(),ue.stepAmount=he(),await t.dispatch("wallet/prolong")}),{deep:!0});const ge=async()=>{try{const e=await t.dispatch("algod/getAlgod"),s=await t.dispatch("indexer/getIndexer"),l=(0,w.k3)(t.state.config.env),d=await e.getApplicationByID(l).do(),o=d.params["global-state"].find((e=>"ZmE="==e.key)).value.uint;ue.feeAssetId=o,ue.feeAssetData=await t.dispatch("indexer/getAsset",{assetIndex:o});const n=a.params.account,i=(D["default"].decodeAddress(n),Number(a.params.appId));ue.appId=i.toString();const c=await e.getApplicationBoxByName(l,(0,w.KA)(l,i).name).do(),r=(0,w.So)(c.value),m=await e.getApplicationByID(i).do(),p=m.params["global-state"].find((e=>"cw=="==e.key)).value.uint,u=m.params["global-state"].find((e=>"cA=="==e.key)).value.uint;ue.appInfo={appId:i,appAddress:D["default"].getApplicationAddress(i),start:p,period:u,balanceFee:r.funds,fee:r.fee};const f=await s.lookupAccountByID(D["default"].getApplicationAddress(i)).do(),A=[];let h=await t.dispatch("indexer/getAsset",{assetIndex:0});if(A.push({"asset-id":0,amount:f.account.amount,assetName:h.name,info:h}),f.account.assets)for(const a of f.account.assets){const e=await t.dispatch("indexer/getAsset",{assetIndex:a["asset-id"]});A.push({"asset-id":a["asset-id"],amount:a.amount,assetName:e.name,info:e})}ue.assets=A}catch(e){console.error(e)}};(0,s.u2)((async()=>{await t.dispatch("wallet/prolong"),await ge();try{const a=JSON.parse(localStorage.getItem("currentAction")??"");if(a.selection&&(ue.selection=a.selection),a.payTo&&(ue.payTo=a.payTo),a.assetData){var e=new m.c;e.amount=a.assetData.amount,e["asset-id"]=a.assetData["asset-id"],e.decimals=a.assetData.decimals,e.label=a.assetData.label,e.name=a.assetData.name,e.type=a.assetData.type,e["unit-name"]=a.assetData["unit-name"],ue.assetData=e}}catch(a){console.error(a.message??a)}}));const we=async()=>{try{const s=await t.dispatch("algod/getAlgod"),l={addr:a.params.account,signer:async(e,a)=>[]};var e=new w.O({resolveBy:"id",id:ue.appInfo.appId,sender:l},s);const d=new D.AtomicTransactionComposer;await e.assetTransfer({assetAmount:0,assetReceiver:ue.appInfo.appAddress,note:"",xferAsset:ue.optin},{sendParams:{fee:A.ue(2e3),atc:d},assets:[ue.optin]});const o=await s.getTransactionParams().do(),n=D["default"].makePaymentTxnWithSuggestedParamsFromObject({amount:1e5,from:l.addr,suggestedParams:o,to:ue.appInfo.appAddress}),i=d.buildGroup().map((e=>e.txn)),c=[n,i[0]],r=D["default"].assignGroupID(c);await t.dispatch("signer/returnToSignAll","ScheduledPayments"),await t.dispatch("signer/toSignArray",{txs:r}),await h.push("/signAll")}catch(s){console.error(s)}},De=async()=>{try{const s=await t.dispatch("algod/getAlgod"),l={addr:a.params.account,signer:async(e,a)=>[]},d=(0,w.k3)(t.state.config.env);var e=new w.ew({resolveBy:"id",id:d,sender:l},s);const o=await s.getTransactionParams().do(),n=D["default"].makeAssetTransferTxnWithSuggestedParamsFromObject({amount:ue.amountToDeposit*10**ue.feeAssetData.decimals,assetIndex:ue.feeAssetId,from:l.addr,suggestedParams:o,to:D["default"].getApplicationAddress(d)}),i=(0,w.KA)(d,ue.appInfo.appId),c=new D.AtomicTransactionComposer;await e.fundTask({deposit:n,taskAppId:ue.appInfo.appId},{sendParams:{fee:A.ue(1e3),atc:c},boxes:[i]});const r=c.buildGroup().map((e=>e.txn));await t.dispatch("signer/returnToSignAll","ScheduledPayments"),await t.dispatch("signer/toSignArray",{txs:r}),await h.push("/signAll")}catch(s){console.error(s)}},ye=async()=>{try{const s=await t.dispatch("algod/getAlgod"),l={addr:a.params.account,signer:async(e,a)=>[]};var e=new w.O({resolveBy:"id",id:ue.appInfo.appId,sender:l},s);const d=new D.AtomicTransactionComposer;if(Number(ue.withdrawAsset)>0){const a=await t.dispatch("indexer/getAsset",{assetIndex:ue.withdrawAsset});await e.assetTransfer({assetAmount:Number(ue.withdrawAmount)*10**a.decimals,assetReceiver:l.addr,note:"",xferAsset:Number(ue.withdrawAsset)},{sendParams:{fee:A.ue(2e3),atc:d},assets:[Number(ue.withdrawAsset)]})}else await e.payment({amount:Number(ue.withdrawAmount)*10**6,receiver:l.addr,note:""},{sendParams:{fee:A.ue(2e3),atc:d}});await s.getTransactionParams().do();const o=d.buildGroup().map((e=>e.txn));await t.dispatch("signer/returnTo","ScheduledPayments"),await t.dispatch("signer/toSign",{txx:o[0]});const n=(0,p.c)(Buffer.from(D["default"].encodeUnsignedTransaction(o[0])).toString("base64"));ue.txID=o[0].txID(),h.push(`/sign/${a.params.account}/${n}`)}catch(s){console.error(s)}},be=e=>{h.push({name:"PayToAccountAndAsset",params:{account:a.params.account,toAccountDirect:ue.appInfo.appAddress,asset:e["asset-id"]}})};async function _e(e){g()(e)&&await t.dispatch("toast/openSuccess",`${e} copied to clipboard`)}const Qe=()=>{h.push({name:"SwapWithTo",params:{account:a.params.account,toAsset:ue.feeAssetId}})},ve=async()=>{try{const e=await t.dispatch("algod/getAlgod"),a=await e.getApplicationByID(ue.appInfo.appId).do(),s=Buffer.from(a.params["global-state"].find((e=>"aWQ="==e.key)).value.bytes,"base64").subarray(2).toString("utf-8"),l=await y.c.get(`https://api-scheduler.biatec.io/v1/file/${s}/input.yaml`);ue.script=l.data}catch(e){console.error(e)}};return(e,a)=>{const t=(0,s.E1)("InputNumber"),n=(0,s.E1)("InputText"),i=(0,s.E1)("Column"),m=(0,s.E1)("DataTable"),p=(0,s.E1)("InputGroup"),u=(0,s.E1)("Textarea"),A=(0,s.E1)("Card");return(0,s.Wz)(),(0,s.Az)(o.c,null,{default:(0,s.Ql)((()=>[(0,s.QD)("h1",null,(0,l.WA)(e.$t("scheduled_payments.title")),1),(0,s.K2)(A,null,{content:(0,s.Ql)((()=>[(0,s.QD)("p",null,(0,l.WA)(e.$t("scheduled_payments.description_detail")),1),(0,s.QD)("h2",null,(0,l.WA)(e.$t("scheduled_payments.details_title")),1),(0,s.QD)("div",b,[(0,s.QD)("label",_,(0,l.WA)(e.$t("scheduled_payments.app_id")),1),(0,s.QD)("div",Q,(0,l.WA)(ue.appInfo.appId),1)]),(0,s.QD)("div",v,[(0,s.QD)("label",I,(0,l.WA)(e.$t("scheduled_payments.appAddress")),1),(0,s.QD)("div",W,(0,l.WA)(ue.appInfo.appAddress),1)]),(0,s.QD)("div",K,[(0,s.QD)("label",$,(0,l.WA)(e.$t("scheduled_payments.period")),1),(0,s.QD)("div",x,(0,l.WA)(ue.appInfo.period)+" "+(0,l.WA)(e.$t("scheduled_payments.seconds")),1)]),(0,s.QD)("div",T,[(0,s.QD)("label",k,(0,l.WA)(e.$t("scheduled_payments.start")),1),(0,s.QD)("div",V,(0,l.WA)(new Date(1e3*ue.appInfo.start)),1)]),(0,s.QD)("div",S,[(0,s.QD)("label",C,(0,l.WA)(e.$t("scheduled_payments.feeBalance")),1),(0,s.QD)("div",P,(0,l.WA)((0,d.KV)(f.c)(ue.appInfo.balanceFee,ue.feeAssetData["unit-name"]??ue.feeAssetData.name,ue.feeAssetData.decimals)),1)]),(0,s.QD)("div",N,[(0,s.QD)("label",B,(0,l.WA)(e.$t("scheduled_payments.execution_fee")),1),(0,s.QD)("div",Y,(0,l.WA)((0,d.KV)(f.c)(ue.appInfo.fee,ue.feeAssetData["unit-name"]??ue.feeAssetData.name,ue.feeAssetData.decimals)),1)]),(0,s.QD)("h2",null,(0,l.WA)(e.$t("scheduled_payments.deposit_fee_title")),1),(0,s.QD)("div",F,[(0,s.QD)("label",U,(0,l.WA)(e.$t("scheduled_payments.fee_asset_id")),1),(0,s.QD)("div",E,[(0,s.K2)((0,d.KV)(r.c),{size:"small",link:"",onClick:a[0]||(a[0]=e=>_e(ue.feeAssetId))},{default:(0,s.Ql)((()=>[(0,s.mY)((0,l.WA)(ue.feeAssetId),1)])),_:1}),(0,s.K2)((0,d.KV)(r.c),{severity:"secondary",size:"small",onClick:Qe},{default:(0,s.Ql)((()=>[(0,s.mY)((0,l.WA)(e.$t("scheduled_payments.get_more")),1)])),_:1})])]),(0,s.QD)("div",z,[(0,s.QD)("label",O,(0,l.WA)(e.$t("scheduled_payments.amount_to_deposit")),1),(0,s.QD)("div",R,[(0,s.K2)(t,{itemId:"amountToDeposit",modelValue:ue.amountToDeposit,"onUpdate:modelValue":a[1]||(a[1]=e=>ue.amountToDeposit=e),min:0,step:1e-6,maxFractionDigits:6,class:"w-full"},null,8,["modelValue"])])]),(0,s.QD)("div",G,[M,(0,s.QD)("div",j,[(0,s.K2)((0,d.KV)(r.c),{severity:"primary",onClick:De},{default:(0,s.Ql)((()=>[(0,s.mY)((0,l.WA)(e.$t("scheduled_payments.deposit")),1)])),_:1})])]),(0,s.QD)("h2",null,(0,l.WA)(e.$t("scheduled_payments.list_of_assets")),1),(0,s.K2)(m,{selection:ue.selection,"onUpdate:selection":a[3]||(a[3]=e=>ue.selection=e),value:ue.assets,"responsive-layout":"scroll","selection-mode":"single",paginator:!0,rows:20,filters:ue.filters,"onUpdate:filters":a[4]||(a[4]=e=>ue.filters=e),filterDisplay:"menu",globalFilterFields:["asset-id","assetName"]},{header:(0,s.Ql)((()=>[ue.filters["global"]?((0,s.Wz)(),(0,s.An)("div",J,[(0,s.QD)("div",L,[(0,s.QD)("span",X,[Z,(0,s.K2)(n,{modelValue:ue.filters["global"].value,"onUpdate:modelValue":a[2]||(a[2]=e=>ue.filters["global"].value=e),placeholder:"Keyword Search"},null,8,["modelValue"])])])])):(0,s.g1)("",!0)])),empty:(0,s.Ql)((()=>[(0,s.mY)((0,l.WA)(e.$t("scheduled_payments.assets_loading")),1)])),default:(0,s.Ql)((()=>[(0,s.K2)(i,{field:"assetName",header:e.$t("scheduled_payments.asset_id"),sortable:!0},null,8,["header"]),(0,s.K2)(i,{header:e.$t("scheduled_payments.asset_id"),sortable:!0},{body:(0,s.Ql)((e=>[(0,s.mY)((0,l.WA)(e.data["asset-id"]),1)])),_:1},8,["header"]),(0,s.K2)(i,{header:e.$t("scheduled_payments.asset_name"),sortable:!0},{body:(0,s.Ql)((e=>[(0,s.mY)((0,l.WA)(e.data.info.name),1)])),_:1},8,["header"]),(0,s.K2)(i,{field:"amount",header:e.$t("scheduled_payments.asset_amount"),sortable:!0},{body:(0,s.Ql)((e=>[e.data.amount&&e.data.info?((0,s.Wz)(),(0,s.An)("span",q,(0,l.WA)((0,d.KV)(f.c)(e.data.amount,e.data.info["unit-name"]??e.data.info.name,e.data.info.decimals)),1)):(0,s.g1)("",!0)])),_:1},8,["header"]),(0,s.K2)(i,{header:e.$t("scheduled_payments.actions"),sortable:!0},{body:(0,s.Ql)((a=>[(0,s.K2)((0,d.KV)(r.c),{onClick:e=>be(a.data)},{default:(0,s.Ql)((()=>[(0,s.mY)((0,l.WA)(e.$t("scheduled_payments.deposit")),1)])),_:2},1032,["onClick"])])),_:1},8,["header"])])),_:1},8,["selection","value","filters"]),(0,s.QD)("h2",null,(0,l.WA)(e.$t("scheduled_payments.optin_title")),1),(0,s.QD)("div",H,[(0,s.QD)("label",ee,(0,l.WA)(e.$t("scheduled_payments.optin_to_asset")),1),(0,s.QD)("div",ae,[(0,s.K2)(p,null,{default:(0,s.Ql)((()=>[(0,s.K2)(t,{itemId:"optin",modelValue:ue.optin,"onUpdate:modelValue":a[5]||(a[5]=e=>ue.optin=e),min:0,step:1,class:"w-full"},null,8,["modelValue"]),(0,s.K2)((0,d.KV)(r.c),{severity:"secondary",class:"col-2",onClick:we},{default:(0,s.Ql)((()=>[(0,s.mY)((0,l.WA)(e.$t("scheduled_payments.optin_click")),1)])),_:1})])),_:1})])]),(0,s.QD)("h2",null,(0,l.WA)(e.$t("scheduled_payments.withdraw_asset_title")),1),(0,s.QD)("div",te,[(0,s.QD)("label",se,(0,l.WA)(e.$t("scheduled_payments.withdraw_asset")),1),(0,s.QD)("div",le,[(0,s.K2)((0,d.KV)(c.c),{inputId:"withdrawAsset",options:ue.assets,modelValue:ue.withdrawAsset,"onUpdate:modelValue":a[6]||(a[6]=e=>ue.withdrawAsset=e),optionLabel:"assetName",optionValue:"asset-id",class:"w-full"},null,8,["options","modelValue"])])]),(0,s.QD)("div",de,[(0,s.QD)("label",oe,(0,l.WA)(e.$t("scheduled_payments.withdraw_amount")),1),(0,s.QD)("div",ne,[(0,s.K2)(p,null,{default:(0,s.Ql)((()=>[(0,s.K2)(t,{itemId:"withdrawAmount",modelValue:ue.withdrawAmount,"onUpdate:modelValue":a[7]||(a[7]=e=>ue.withdrawAmount=e),min:0,step:1e-6,maxFractionDigits:6,class:"w-full"},null,8,["modelValue"])])),_:1})])]),(0,s.QD)("div",ie,[ce,(0,s.QD)("div",re,[(0,s.K2)((0,d.KV)(r.c),{severity:"secondary",onClick:ye},{default:(0,s.Ql)((()=>[(0,s.mY)((0,l.WA)(e.$t("scheduled_payments.withdraw_click")),1)])),_:1})])]),(0,s.QD)("h2",null,(0,l.WA)(e.$t("scheduled_payments.load_script_title")),1),(0,s.QD)("div",me,[(0,s.K2)((0,d.KV)(r.c),{severity:"secondary",onClick:ve},{default:(0,s.Ql)((()=>[(0,s.mY)((0,l.WA)(e.$t("scheduled_payments.load_click")),1)])),_:1})]),ue.script?((0,s.Wz)(),(0,s.An)("div",pe,[(0,s.K2)(u,{id:"script",modelValue:ue.script,"onUpdate:modelValue":a[8]||(a[8]=e=>ue.script=e),class:"w-full",rows:"20"},null,8,["modelValue"])])):(0,s.g1)("",!0)])),_:1})])),_:1})}}});const fe=ue;var Ae=fe}}]);
//# sourceMappingURL=734.716f064a.js.map